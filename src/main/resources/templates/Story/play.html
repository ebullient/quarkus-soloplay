{#include base}
    {#title}Play: {thread.name}{/title}

    {#stylesheets}
    <link rel="stylesheet" href="/play.css">
    {/stylesheets}

    {#scripts}
    <script>
        // Store story thread info globally
        window.storyThread = {
            id: '{thread.id}',
            name: '{thread.name}'
        };
    </script>
    {/scripts}

    {#header-title}{thread.name}{/header-title}

    {#content}
    <div class="play-container">
        <!-- Party Sidebar -->
        <aside class="party-sidebar">
            <div class="party-header">
                <h3>Party</h3>
                <a href="/story/{thread.id}/character/create" class="btn btn-small">+ New Character</a>
            </div>
            {#if partyMembers.isEmpty()}
                <p class="empty-party">No party members yet. Create your character to begin!</p>
            {#else}
                {#for character in partyMembers}
                    <div class="party-member">
                        <div class="party-member-header">
                            <h4>{character.name}</h4>
                            <a href="/story/{thread.id}/character/{character.id}/edit" class="edit-link" title="Edit character">âœï¸</a>
                        </div>
                        <p>{character.summary}</p>
                        {#if character.characterClass || character.level}
                            <p class="character-stats">
                                {#if character.characterClass}{character.characterClass}{/if}
                                {#if character.level} Level {character.level}{/if}
                            </p>
                        {/if}
                        {#if character.tags}
                            <div class="tags">
                                {#for tag in character.tags}
                                    <span class="tag">{tag}</span>
                                {/for}
                            </div>
                        {/if}
                    </div>
                {/for}
            {/if}

            <nav class="action-links sidebar-links" aria-label="Story actions">
                <a href="/story">â† Switch Story</a>
                <a href="/story/{thread.id}/configure">âš™ï¸ Configure</a>
                <a href="/inspect?storyThreadId={thread.id}">ğŸ” Inspect Data</a>
                <a href="/lore">ğŸ“– Query Lore</a>
            </nav>
        </aside>

        <!-- Main Play Area -->
        <main>
            <header class="story-header">
                <h1>{thread.name}</h1>
                <div class="story-meta">
                    <span>ğŸ“… Day {thread.currentDay}</span>
                    {#if thread.adventureName}
                        <span>ğŸ“œ {thread.adventureName}</span>
                    {/if}
                    {#if thread.followingMode}
                        <span>ğŸ¯ {thread.followingMode}</span>
                    {/if}
                </div>
            </header>

            {#if thread.currentSituation}
                <aside class="current-situation">
                    <h3>Current Situation</h3>
                    <p>{thread.currentSituation}</p>
                </aside>
            {/if}

            <section class="chat-area">
                <div id="chat-messages">
                    {#if partyMembers.isEmpty()}
                    <div class="message system">
                        <p><strong>Welcome to {thread.name}!</strong></p>
                        <p>Before you begin your adventure, you need to create at least one character.</p>
                        <p><a href="/story/{thread.id}/character/create" class="btn btn-primary">Create Your Character</a></p>
                    </div>
                    {#else}
                    <div class="message system" id="initial-welcome">
                        {#if gmGreeting}
                        {gmGreeting.raw}
                        {#else}
                        <p>Welcome to your solo adventure! Describe what your character does, ask questions, or request a ruling from the GM.</p>
                        {/if}
                    </div>
                    {/if}
                </div>

                <div class="input-area">
                    <textarea
                        id="message-input"
                        placeholder="{#if partyMembers.isEmpty()}Create a character first...{#else}What do you do?{/if}"
                        autocomplete="off"
                        {#if !partyMembers.isEmpty()}autofocus{/if}
                        {#if partyMembers.isEmpty()}disabled{/if}
                        rows="1"></textarea>
                    <button id="send-button" {#if partyMembers.isEmpty()}disabled{/if}>Send</button>
                </div>
            </section>
        </main>
    </div>
    {/content}

    {#footer-scripts}
    <script src="/play-interface.js"></script>
    {/footer-scripts}
{/include}
