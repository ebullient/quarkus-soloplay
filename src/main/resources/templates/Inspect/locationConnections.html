{#include base}
    {#title}Location Connections - {location.name}{/title}

    {#stylesheets}
    <link rel="stylesheet" href="/inspector.css">
    {/stylesheets}

    {#header-title}Location Connections{/header-title}

    {#header-subtitle}
        <p>Campaign: {location.storyThreadId}</p>
    {/header-subtitle}

    {#nav}
    <nav>
        <a href="/chat">Chat Interface</a>
        <a href="/lore">Lore Questions</a>
        <a href="/ingest">Ingest Documents</a>
        <a href="/inspect" class="active">My Game</a>
    </nav>
    {/nav}

    {#content}
    <div class="breadcrumb">
        <a href="/inspect/story/{location.storyThreadId}">Inspect</a> &gt;
        <a href="/inspect/story/{location.storyThreadId}/locations">Locations</a> &gt;
        <a href="/inspect/story/{location.storyThreadId}/locations/{location.slug}">{location.name}</a> &gt;
        <span>Connections</span>
    </div>

    <h2>{location.name} - Character Connections</h2>

    <div class="location-summary">
        {#if location.tags}
        <p><strong>Tags:</strong> {#each location.tags}{it}{#if it_hasNext}, {/if}{/each}</p>
        {/if}
        {#if location.summary}
            <p><strong>Summary:</strong> {location.summary}</p>
        {/if}
    </div>

    <div class="actions">
        <a href="/inspect/story/{location.storyThreadId}/ai/location-connections/{location.slug}" class="btn btn-ai">View AI Output</a>
    </div>

    {#if connectedCharacters.isEmpty()}
        <div class="empty-state">
            <p>No characters have been recorded at {location.name}.</p>
        </div>
    {#else}
        <div class="connected-characters">
            <h3>Characters who have been at this location:</h3>
            <div class="character-list">
                {#for character in connectedCharacters}
                    <div class="character-card">
                        <div class="character-info">
                            <a href="/inspect/story/{location.storyThreadId}/characters/{character.slug}">
                                <strong>{character.name}</strong>
                            </a>
                            {#if character.tags}
                            <span class="character-tags">({#each character.tags}{it}{#if it_hasNext}, {/if}{/each})</span>
                            {/if}
                            {#if character.summary}
                                <p class="character-summary">{character.summary}</p>
                            {/if}
                        </div>
                        <div class="character-actions">
                            <a href="/inspect/story/{location.storyThreadId}/characters/{character.slug}/relationships" class="btn btn-sm">
                                View Relationships
                            </a>
                        </div>
                    </div>
                {/for}
            </div>
        </div>
    {/if}

    <div class="location-actions">
        <h3>Analysis Options</h3>
        {#if connectedCharacters.size() > 1}
            <p>Compare connections between characters at this location:</p>
            <div class="comparison-grid">
                {#for char1 in connectedCharacters}
                    {#for char2 in connectedCharacters}
                        {#if char1.id != char2.id && char1.name < char2.name}
                            <a href="/inspect/story/{location.storyThreadId}/shared-history?char1Slug={char1.slug}&char2Slug={char2.slug}"
                               class="btn btn-sm btn-outline">
                                {char1.name} â†” {char2.name}
                            </a>
                        {/if}
                    {/for}
                {/for}
            </div>
        {/if}
    </div>
    {/content}
{/include}
